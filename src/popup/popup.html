<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BookDrive</title>
    <link rel="stylesheet" href="popup.css" />
  </head>
  <body>
    <div id="onboarding" style="display: none; padding: 1em">
      <h2>Welcome to BookDrive!</h2>
      <p>
        To get started, sign in with your Google account to enable bookmark sync via your own Drive.
      </p>
      <button id="onboarding-signin-btn">Sign in with Google</button>
      <div id="onboarding-clientid" style="margin-top: 1em; display: none">
        <p><b>Missing OAuth2 Client ID!</b></p>
        <p>To use BookDrive, you need to set up a Google OAuth2 Client ID for this extension.</p>
        <ol>
          <li>
            Run the <code>scripts/setup_oauth2.sh</code> or
            <code>scripts/setup_oauth2.js</code> script in the repo.
          </li>
          <li>Follow the instructions to create a Google Cloud project and OAuth2 credentials.</li>
          <li>
            Paste the generated client_id into <code>src/manifest.json</code> and reload the
            extension.
          </li>
        </ol>
        <p>
          See the README or
          <a href="https://developers.google.com/identity/protocols/oauth2" target="_blank"
            >Google OAuth2 docs</a
          >
          for more info.
        </p>
      </div>
    </div>
    <div id="welcome-setup" style="display: none; padding: 1em">
      <h2>Setup Complete!</h2>
      <p>You're signed in. Next, choose your preferred sync mode and settings.</p>
      <button id="go-to-settings-btn">Go to Settings</button>
    </div>
    <div
      id="setup-wizard"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.5);
        z-index: 10001;
      "
    >
      <div
        id="wizard-content"
        style="
          background: #fff;
          max-width: 400px;
          margin: 5vh auto;
          padding: 2em;
          border-radius: 12px;
          box-shadow: 0 2px 16px rgba(0, 0, 0, 0.2);
          position: relative;
        "
      >
        <div id="wizard-step-welcome">
          <h2>Welcome to BookDrive</h2>
          <p>Sync your bookmarks privately and securely using your own Google Drive.</p>
          <button id="wizard-next-1">Get Started</button>
        </div>
        <div id="wizard-step-mode" style="display: none">
          <h2>Choose Sync Mode</h2>
          <p>
            <label
              ><input type="radio" name="wizard-mode" value="host" checked /> Host-to-Many
              (One-way)</label
            ><br />
            <label
              ><input type="radio" name="wizard-mode" value="global" /> Global Sync (Two-way)</label
            >
          </p>
          <button id="wizard-prev-2">Back</button>
          <button id="wizard-next-2">Next</button>
        </div>
        <div id="wizard-step-auth" style="display: none">
          <h2>Authorize Google Drive</h2>
          <p>Sign in with your Google account to enable sync.</p>
          <button id="wizard-auth-btn">Sign in with Google</button>
          <button id="wizard-prev-3">Back</button>
        </div>
        <div id="wizard-step-backup" style="display: none">
          <h2>Backup Current Bookmarks</h2>
          <p>Optional: Backup your current bookmarks before starting sync.</p>
          <button id="wizard-backup-btn">Backup Now</button>
          <button id="wizard-skip-backup-btn">Skip</button>
        </div>
        <div id="wizard-step-done" style="display: none">
          <h2>Setup Complete!</h2>
          <p>BookDrive is ready. You can change settings anytime.</p>
          <button id="wizard-done-btn">Open BookDrive</button>
        </div>
      </div>
    </div>
    <div id="popup-root">
      <nav class="tabs" role="tablist">
        <button
          class="tab active"
          data-tab="home"
          role="tab"
          aria-selected="true"
          aria-controls="home-panel"
          tabindex="0"
        >
          Home
        </button>
        <button
          class="tab"
          data-tab="settings"
          role="tab"
          aria-selected="false"
          aria-controls="settings-panel"
          tabindex="-1"
        >
          Settings
        </button>
        <button
          class="tab"
          data-tab="advanced"
          role="tab"
          aria-selected="false"
          aria-controls="advanced-panel"
          tabindex="-1"
        >
          Advanced
        </button>
        <button
          class="tab"
          data-tab="logs"
          role="tab"
          aria-selected="false"
          aria-controls="logs-panel"
          tabindex="-1"
        >
          Logs
        </button>
      </nav>
      <section id="tab-content">
        <div class="tab-panel" id="home-panel" role="tabpanel" aria-labelledby="home-tab">
          <div><strong>Device ID:</strong> <span id="device-id">...</span></div>
          <div><strong>Sync Mode:</strong> <span id="sync-mode">...</span></div>
          <div style="margin-top: 1em">
            <button id="sync-now-btn">Sync Now</button>
            <span id="sync-status" style="margin-left: 1em"></span>
          </div>
          <div style="margin-top: 1em">Home content (status, sync now, etc.)</div>
        </div>
        <div
          class="tab-panel hidden"
          id="settings-panel"
          role="tabpanel"
          aria-labelledby="settings-tab"
        >
          Settings content (mode, theme, etc.)
          <div style="margin-top: 1em">
            <label for="theme-select">Theme:</label>
            <select id="theme-select">
              <option value="auto">Auto</option>
              <option value="light">Light</option>
              <option value="dark">Dark</option>
            </select>
          </div>
          <div style="margin-top: 1em">
            <label for="mode-select">Sync Mode:</label>
            <select id="mode-select">
              <option value="host">Host-to-Many</option>
              <option value="global">Global Sync</option>
            </select>
          </div>
          <div style="margin-top: 1em">
            <label><input type="checkbox" id="auto-sync-toggle" /> Auto Sync</label>
            <label style="margin-left: 1em"
              >Interval:
              <input
                type="number"
                id="sync-interval"
                min="5"
                max="30"
                step="1"
                style="width: 3em"
              />
              min</label
            >
          </div>
          <div style="margin-top: 1em">
            <label
              ><input type="checkbox" id="team-mode-toggle" /> Enable Team Mode (Multi-User)</label
            >
            <input
              type="email"
              id="user-email"
              placeholder="Your Email (for Team Mode)"
              style="margin-left: 1em; width: 200px"
            />
          </div>
        </div>
        <div
          class="tab-panel hidden"
          id="advanced-panel"
          role="tabpanel"
          aria-labelledby="advanced-tab"
        >
          <div>
            <label><input type="checkbox" id="verbose-logs-toggle" /> Verbose Logs</label>
          </div>
          <div style="margin-top: 1em">
            <button id="drive-cleanup-btn">Drive Cleanup Tool</button>
            <button id="conflict-viewer-btn">Conflict Viewer</button>
          </div>
          <div style="margin-top: 1em">
            <button id="manual-backup-btn">Manual Backup</button>
            <button id="manual-restore-btn">Restore from Backup</button>
            <button id="preview-sync-btn">Preview Sync</button>
            <button id="export-settings-btn">Export Settings</button>
            <button id="import-settings-btn">Import Settings</button>
          </div>
          <div style="margin-top: 2em" id="sync-graph-section">
            <b>Sync Timeline</b>
            <canvas id="sync-graph-canvas" width="320" height="120"></canvas>
          </div>
          <div style="margin-top: 2em" id="team-members-section">
            <b>Team Members</b>
            <div id="team-members-list">Loading...</div>
            <div id="team-management" style="margin-top: 1em; display: none;">
              <input type="email" id="new-member-email" placeholder="Enter email address" style="width: 200px;">
              <select id="new-member-role">
                <option value="member">Member</option>
                <option value="admin">Admin</option>
              </select>
              <button id="add-member-btn">Add Member</button>
            </div>
          </div>
        </div>
        <div class="tab-panel hidden" id="logs-panel" role="tabpanel" aria-labelledby="logs-tab">
          <div id="logs-list">Loading logs...</div>
          <button id="download-log-btn" style="margin-top: 1em">Download Full Log</button>
        </div>
      </section>
      
      <!-- Conflict Resolution Modal -->
      <div id="conflict-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
          <h2>Resolve Sync Conflicts</h2>
          <div id="conflict-list"></div>
          <div class="modal-actions">
            <button id="resolve-conflicts-btn">Resolve Selected</button>
            <button id="auto-resolve-btn">Auto Resolve</button>
            <button id="cancel-conflicts-btn">Cancel</button>
          </div>
        </div>
      </div>
      
      <!-- Encryption Setup Modal -->
      <div id="encryption-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
          <h2>Setup Encryption</h2>
          <div class="form-group">
            <label for="encryption-passphrase">Passphrase:</label>
            <input type="password" id="encryption-passphrase" placeholder="Enter strong passphrase">
            <div id="passphrase-strength"></div>
          </div>
          <div class="form-group">
            <label for="confirm-passphrase">Confirm Passphrase:</label>
            <input type="password" id="confirm-passphrase" placeholder="Confirm passphrase">
          </div>
          <div class="modal-actions">
            <button id="enable-encryption-btn">Enable Encryption</button>
            <button id="cancel-encryption-btn">Cancel</button>
          </div>
        </div>
      </div>
      
      <div
        id="toast-container"
        role="status"
        aria-live="polite"
        style="position: fixed; bottom: 1em; left: 50%; transform: translateX(-50%); z-index: 10002"
      ></div>
    </div>
    
    <script src="popup.js"></script>
  </body>
</html>
